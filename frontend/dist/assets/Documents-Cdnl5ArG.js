import{j as e,S as t,l as s,n as a,m as l,F as r,X as n,o as i,p as d,q as o,r as c,s as x,t as m,g as u,E as p,u as h,v as g,w as b}from"./vendor-ui-CAagWUPt.js";import{r as y}from"./vendor-react-CtfPXauy.js";import{a as j,z as f}from"./index-IoBOCSTw.js";import"./vendor-supabase-QeT-7LZZ.js";const N=["All","Contract","Insurance","ID","Bill","Legal","Medical","Financial","Personal","Certificate","Other","Uncategorized"],v=()=>{var v,w;const[z,D]=y.useState([]),[k,C]=y.useState(""),[L,S]=y.useState("All"),[E,U]=y.useState(!0),A=y.useRef(null),R=async()=>{try{const e=await j.get("/documents");D(Array.isArray(e.data)?e.data:[]),U(!1)}catch(e){f.error("Failed to load documents"),D([]),U(!1)}};y.useEffect(()=>{R()},[]);const P={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},[F,I]=y.useState(null),[O,T]=y.useState(null);y.useEffect(()=>{const e=e=>{F&&!e.target.closest(".document-menu-container")&&I(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[F]);const $=e=>{if(!e)return"";if(e.startsWith("http"))return e;return`/${e.replace(/\\/g,"/")}`},M=e=>{const t=$(e.path);window.open(t,"_blank")},V=async e=>{try{const t=f.loading("Starting download..."),s=$(e.path);let a;if(s.startsWith("http")){if(a=await fetch(s),!a.ok)throw new Error("Download failed");const t=await a.blob(),l=document.createElement("a");l.href=window.URL.createObjectURL(t),l.download=e.name,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(l.href)}else{a=await j.get(s,{responseType:"blob"});const t=new Blob([a.data],{type:a.headers["content-type"]}),l=document.createElement("a");l.href=window.URL.createObjectURL(t),l.download=e.name,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(l.href)}f.success("Download started",{id:t})}catch(t){f.error("Failed to download file")}},W=(e,t)=>{e.stopPropagation(),(async e=>{if(!window.confirm("Are you sure you want to delete this document?"))return;const t=f.loading("Deleting...");try{await j.delete(`/documents/${e}`),f.success("Document deleted",{id:t}),D(z.filter(t=>t.id!==e))}catch(s){f.error("Delete failed",{id:t})}})(t),I(null)},B=z.filter(e=>{const t=e.name.toLowerCase().includes(k.toLowerCase()),s="All"===L||e.category===L;return t&&s});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main mb-1",children:"Documents"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Manage and organize your critical life documents."})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx(t,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",size:18}),e.jsx("input",{type:"text",placeholder:"Search files...",className:"input pl-10 bg-white",value:k,onChange:e=>C(e.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(s,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",size:16}),e.jsx("select",{value:L,onChange:e=>S(e.target.value),className:"input pl-9 pr-8 bg-white appearance-none cursor-pointer text-sm min-w-[130px]",children:N.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("input",{type:"file",ref:A,className:"hidden",onChange:async e=>{var t,s;const a=e.target.files[0];if(!a)return;const l=new FormData;l.append("document",a),l.append("category","Uncategorized");const r=f.loading("Uploading & analyzing document...");try{await j.post("/documents",l,{headers:{"Content-Type":"multipart/form-data"}}),f.success("Document uploaded & analyzed!",{id:r}),R()}catch(n){f.error((null==(s=null==(t=n.response)?void 0:t.data)?void 0:s.message)||"Upload failed",{id:r})}}}),e.jsxs("button",{onClick:()=>A.current.click(),className:"btn btn-primary flex items-center gap-2 shadow-sm",children:[e.jsx(a,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Upload"})]})]})]}),O&&O.analysis&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(l.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(r,{size:20}),"Document Intelligence"]}),e.jsx("p",{className:"text-blue-100 text-sm",children:O.name})]}),e.jsx("button",{onClick:()=>T(null),className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(n,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100",children:[e.jsxs("h3",{className:"font-bold text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(i,{size:18}),"Executive Summary"]}),e.jsx("p",{className:"text-blue-900/80 text-sm leading-relaxed",children:O.analysis.summary||"Analysis pending..."})]}),O.analysis.plainLanguageExplanation&&e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-xl border border-emerald-100",children:[e.jsxs("h3",{className:"font-bold text-emerald-800 mb-2 flex items-center gap-2",children:[e.jsx(d,{size:18}),"What This Means (Plain Language)"]}),e.jsx("p",{className:"text-emerald-900/80 text-sm leading-relaxed",children:O.analysis.plainLanguageExplanation})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-text-main flex items-center gap-2",children:[e.jsx(o,{size:18,className:"text-primary"}),"Key Dates"]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Expiry Date"}),e.jsx("span",{className:"font-medium "+(O.analysis.expiryDate?"text-text-main":"text-text-muted"),children:O.analysis.expiryDate?new Date(O.analysis.expiryDate).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Renewal Date"}),e.jsx("span",{className:"font-medium "+(O.analysis.renewalDate?"text-text-main":"text-text-muted"),children:O.analysis.renewalDate?new Date(O.analysis.renewalDate).toLocaleDateString():"N/A"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-text-main flex items-center gap-2",children:[e.jsx(c,{size:18,className:"text-primary"}),"Smart Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(null==(v=O.analysis.tags)?void 0:v.length)>0?O.analysis.tags.map((t,s)=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-text-muted rounded-full text-xs font-medium border border-gray-200",children:t},s)):e.jsx("span",{className:"text-text-muted text-sm italic",children:"No tags detected"})}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:"Category"}),e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-bold",children:O.category})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-bold text-text-main flex items-center gap-2 text-red-600",children:[e.jsx(x,{size:18}),"Risks & Obligations"]}),e.jsx("ul",{className:"space-y-2",children:(null==(w=O.analysis.risks)?void 0:w.length)>0?O.analysis.risks.map((t,s)=>e.jsxs("li",{className:"flex items-start gap-3 bg-red-50 p-3 rounded-lg border border-red-100/50",children:[e.jsx("div",{className:"mt-0.5 min-w-[6px] h-[6px] rounded-full bg-red-500"}),e.jsx("span",{className:"text-sm text-red-800",children:t})]},s)):e.jsx("li",{className:"text-text-muted text-sm italic",children:"No risks detected"})})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-end",children:e.jsx("button",{onClick:()=>T(null),className:"btn btn-primary",children:"Close Insights"})})]})}),E?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):B.length>0?e.jsx(l.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:B.map(t=>{var s;const a=(e=>{var t;const s=null==(t=e.analysis)?void 0:t.expiryDate;if(!s)return null;const a=new Date(s);if(isNaN(a.getTime()))return null;const l=new Date,r=Math.ceil((a-l)/864e5);return r<0?{label:"Expired",color:"bg-red-100 text-red-700 border-red-200",daysLeft:r}:r<=30?{label:`${r}d left`,color:"bg-amber-100 text-amber-700 border-amber-200",daysLeft:r}:{label:`${r}d`,color:"bg-green-100 text-green-700 border-green-200",daysLeft:r}})(t);return e.jsxs(l.div,{variants:P,whileHover:{y:-5},className:"group card p-5 hover:shadow-lg transition-all duration-300 relative overflow-visible border border-border-light/50",children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex gap-1.5",children:[t.analysis&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold uppercase tracking-wider rounded-full border border-green-200",children:[e.jsx(m,{size:10})," AI"]}),a&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded-full border ${a.color}`,children:[e.jsx(u,{size:10})," ",a.label]})]}),e.jsxs("div",{className:"document-menu-container absolute top-4 right-4 z-20",children:[e.jsx("button",{onClick:e=>((e,t)=>{e.stopPropagation(),I(F===t?null:t)})(e,t.id),className:"p-1.5 hover:bg-gray-100 rounded-lg text-text-muted hover:text-text-main transition-colors",children:e.jsx(p,{size:16})}),F===t.id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-1 z-30",children:[e.jsxs("button",{onClick:()=>M(t),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(h,{size:14})," View"]}),e.jsxs("button",{onClick:()=>V(t),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(g,{size:14})," Download"]}),e.jsx("div",{className:"h-px bg-gray-100 my-1"}),e.jsxs("button",{onClick:e=>W(e,t.id),className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(b,{size:14})," Delete"]})]})]}),e.jsxs("div",{className:"flex items-start gap-4 mb-4 mt-6",children:[e.jsx("div",{className:"p-4 rounded-xl "+("PDF"===t.type?"bg-red-50 text-red-500":"JPEG"===t.type||"PNG"===t.type?"bg-purple-50 text-purple-500":"bg-blue-50 text-blue-500"),children:e.jsx(r,{size:32})}),e.jsxs("div",{className:"flex-1 min-w-0 pr-6",children:[e.jsx("h3",{className:"font-semibold text-text-main truncate group-hover:text-primary transition-colors cursor-pointer",onClick:()=>M(t),children:t.name}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-primary/10 text-primary rounded text-[10px] font-semibold mr-1",children:t.category}),t.size]})]})]}),(null==(s=t.analysis)?void 0:s.summary)&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-100",children:e.jsxs("p",{className:"text-xs text-text-muted line-clamp-2 leading-relaxed",children:[e.jsx("span",{className:"font-semibold text-primary",children:"AI Summary:"})," ",t.analysis.summary]})}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-4 border-t border-border-light/50",children:[t.analysis?e.jsxs("button",{onClick:e=>{e.stopPropagation(),T(t)},className:"text-xs font-medium text-primary hover:text-primary-dark flex items-center gap-1 transition-colors",children:[e.jsx(m,{size:14})," View Insights"]}):e.jsx("span",{className:"text-xs text-text-muted font-medium bg-gray-50 px-2 py-1 rounded-md",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(t),className:"p-1.5 text-text-muted hover:text-primary hover:bg-primary/10 rounded transition-colors",title:"View",children:e.jsx(h,{size:16})}),e.jsx("button",{onClick:()=>V(t),className:"p-1.5 text-text-muted hover:text-success hover:bg-success/10 rounded transition-colors",title:"Download",children:e.jsx(g,{size:16})}),e.jsx("button",{onClick:e=>W(e,t.id),className:"p-1.5 text-text-muted hover:text-danger hover:bg-danger/10 rounded transition-colors",title:"Delete",children:e.jsx(b,{size:16})})]})]})]},t.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-text-muted bg-white rounded-2xl border border-dashed border-border-light",children:[e.jsx(r,{size:64,className:"mb-4 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:z.length>0?"No documents match your filters.":"No documents found."}),e.jsx("div",{className:"mt-4",children:z.length>0?e.jsx("button",{onClick:()=>{C(""),S("All")},className:"btn btn-secondary text-sm",children:"Clear Filters"}):e.jsx("button",{onClick:()=>A.current.click(),className:"btn btn-secondary text-sm",children:"Upload your first document"})})]})]})};export{v as default};
