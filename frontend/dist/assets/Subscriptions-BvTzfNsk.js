import{j as e,S as t,P as s,m as a,C as i,k as l,T as r,g as n,u as d,x as c,w as o,q as x,X as m}from"./vendor-ui-CAagWUPt.js";import{r as p}from"./vendor-react-CtfPXauy.js";import{a as h,z as u}from"./index-IoBOCSTw.js";import"./vendor-supabase-QeT-7LZZ.js";const b=()=>{const[b,g]=p.useState([]),[j,y]=p.useState(!1),[f,N]=p.useState(!0),[v,w]=p.useState(!1),[C,S]=p.useState(null),[D,k]=p.useState(null),[z,M]=p.useState(""),[P,B]=p.useState({name:"",price:"",billingCycle:"Monthly",nextBillingDate:"",category:"General",paymentMethod:"Credit Card"}),L=async()=>{try{const{data:e}=await h.get("/subscriptions");g(e),N(!1)}catch(e){u.error("Failed to load subscriptions"),N(!1)}};p.useEffect(()=>{L()},[]);const $=e=>{B({...P,[e.target.name]:e.target.value})},A=()=>{B({name:"",price:"",billingCycle:"Monthly",nextBillingDate:"",category:"General",paymentMethod:"Credit Card"}),w(!1),S(null),y(!1)},F=b.reduce((e,t)=>{const s=parseFloat(t.price);return"Monthly"===(t.period||t.billingCycle)?e+s:e+s/12},0),T=b.filter(e=>e.name.toLowerCase().includes(z.toLowerCase())||e.category.toLowerCase().includes(z.toLowerCase())),O=e=>{const t=new Date(e.nextBillingDate||e.nextPayment);if(isNaN(t.getTime()))return null;const s=new Date,a=Math.ceil((t-s)/864e5);return a<0?{label:"Overdue",color:"bg-red-100 text-red-700 border-red-200",daysLeft:a,urgent:!0}:0===a?{label:"Due today",color:"bg-red-100 text-red-700 border-red-200",daysLeft:a,urgent:!0}:1===a?{label:"Tomorrow",color:"bg-amber-100 text-amber-700 border-amber-200",daysLeft:a,urgent:!0}:a<=3?{label:`${a}d left`,color:"bg-amber-100 text-amber-700 border-amber-200",daysLeft:a,urgent:!0}:a<=7?{label:`${a}d left`,color:"bg-blue-100 text-blue-700 border-blue-200",daysLeft:a,urgent:!1}:null},q=e=>{const t=parseFloat(e.price);return("Monthly"===e.billingCycle?t:t/12)>=50},E={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},H=b.filter(q).length,U=b.filter(e=>{var t;return null==(t=O(e))?void 0:t.urgent}).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main mb-1",children:"Subscriptions"}),e.jsx("p",{className:"text-text-muted text-sm",children:"Track recurring expenses and renewal dates."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted",size:18}),e.jsx("input",{type:"text",placeholder:"Search...",className:"pl-10 pr-4 py-2 border border-border-light rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 w-full md:w-64",value:z,onChange:e=>M(e.target.value)})]}),e.jsxs("button",{onClick:()=>y(!0),className:"btn btn-primary flex items-center gap-2 shadow-sm",children:[e.jsx(s,{size:18})," Add Subscription"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"card p-5 bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(i,{size:18,className:"text-white"})}),e.jsx("span",{className:"font-medium text-white/90 text-sm",children:"Total Monthly Cost"})]}),e.jsxs("div",{className:"text-3xl font-bold",children:["$",F.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-white/70 mt-1",children:[b.length," active subscriptions"]})]}),e.jsxs(a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-5 shadow-lg "+(H>0?"bg-gradient-to-r from-amber-500 to-orange-500 text-white":"bg-white border border-gray-100"),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg "+(H>0?"bg-white/20":"bg-amber-50"),children:e.jsx(l,{size:18,className:H>0?"text-white":"text-amber-500"})}),e.jsx("span",{className:"font-medium text-sm "+(H>0?"text-white/90":"text-gray-500"),children:"High-Cost Subs"})]}),e.jsx("div",{className:"text-3xl font-bold "+(H>0?"":"text-gray-800"),children:H}),e.jsx("p",{className:"text-xs mt-1 "+(H>0?"text-white/70":"text-gray-400"),children:H>0?"Over $50/mo each":"No high-cost subscriptions"})]}),e.jsxs(a.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-5 shadow-lg "+(U>0?"bg-gradient-to-r from-red-500 to-rose-500 text-white":"bg-white border border-gray-100"),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg "+(U>0?"bg-white/20":"bg-red-50"),children:e.jsx(r,{size:18,className:U>0?"text-white":"text-red-400"})}),e.jsx("span",{className:"font-medium text-sm "+(U>0?"text-white/90":"text-gray-500"),children:"Due Soon"})]}),e.jsx("div",{className:"text-3xl font-bold "+(U>0?"":"text-gray-800"),children:U}),e.jsx("p",{className:"text-xs mt-1 "+(U>0?"text-white/70":"text-gray-400"),children:U>0?"Renewals within 3 days":"No imminent renewals"})]})]}),f?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):T.length>0?e.jsx(a.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:T.map(t=>{const s=O(t),i=q(t);return e.jsxs(a.div,{variants:E,className:"card p-5 hover:shadow-md transition-shadow relative group "+((null==s?void 0:s.urgent)?"ring-2 ring-amber-300/50":""),children:[e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex gap-1.5 flex-wrap",children:[i&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-bold uppercase tracking-wider rounded-full border border-amber-200",children:[e.jsx(l,{size:10})," High Cost"]}),s&&e.jsxs("span",{className:`flex items-center gap-1 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded-full border ${s.color}`,children:[e.jsx(n,{size:10})," ",s.label]})]}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[e.jsx("button",{onClick:()=>(e=>{k(e)})(t),className:"text-text-muted hover:text-primary p-1 bg-white rounded-full shadow-sm",title:"Preview",children:e.jsx(d,{size:16})}),e.jsx("button",{onClick:()=>(e=>{B({name:e.name,price:e.price,billingCycle:e.period||e.billingCycle||"Monthly",nextBillingDate:(e.nextPayment||e.nextBillingDate||"").toString().split("T")[0],category:e.category,paymentMethod:e.paymentMethod||"Credit Card"}),S(e.id),w(!0),y(!0)})(t),className:"text-text-muted hover:text-primary p-1 bg-white rounded-full shadow-sm",title:"Edit",children:e.jsx(c,{size:16})}),e.jsx("button",{onClick:()=>(async e=>{if(!window.confirm("Delete this subscription?"))return;const t=u.loading("Deleting...");try{await h.delete(`/subscriptions/${e}`),u.success("Subscription deleted",{id:t}),g(b.filter(t=>t.id!==e))}catch(s){u.error("Failed to delete",{id:t})}})(t.id),className:"text-text-muted hover:text-red-500 p-1 bg-white rounded-full shadow-sm",title:"Delete",children:e.jsx(o,{size:16})})]}),e.jsxs("div",{className:"flex items-start gap-4 "+(i||s?"mt-6":""),children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gray-100 flex items-center justify-center text-primary text-xl font-bold",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-text-main",children:t.name}),e.jsx("p",{className:"text-sm text-text-muted",children:t.category}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-bold text-text-main",children:["$",t.price]}),e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded text-text-muted font-medium",children:t.period||t.billingCycle})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border-light flex items-center gap-2 text-xs text-text-muted",children:[e.jsx(x,{size:14}),e.jsxs("span",{children:["Next billing: ",new Date(t.nextPayment||t.nextBillingDate).toLocaleDateString()]})]})]},t.id)})}):e.jsx("div",{className:"text-center py-20 text-text-muted bg-white rounded-2xl border border-dashed border-border-light",children:e.jsx("p",{children:"No subscriptions found. Add one to get started!"})}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:v?"Edit Subscription":"Add Subscription"}),e.jsx("button",{onClick:A,className:"text-text-muted hover:text-text-main",children:e.jsx(m,{size:24})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const t=u.loading(v?"Updating subscription...":"Adding subscription..."),s={name:P.name,price:P.price,period:P.billingCycle,category:P.category,nextPayment:P.nextBillingDate,paymentMethod:P.paymentMethod};try{v?(await h.put(`/subscriptions/${C}`,s),u.success("Subscription updated!",{id:t})):(await h.post("/subscriptions",s),u.success("Subscription added!",{id:t})),L(),A()}catch(a){u.error(v?"Failed to update":"Failed to add",{id:t})}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Name"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"input w-full",placeholder:"Netflix, Spotify...",value:P.name,onChange:$})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Price"}),e.jsx("input",{type:"number",name:"price",required:!0,className:"input w-full",placeholder:"0.00",value:P.price,onChange:$})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Cycle"}),e.jsxs("select",{name:"billingCycle",className:"input w-full",value:P.billingCycle,onChange:$,children:[e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Category"}),e.jsx("input",{type:"text",name:"category",className:"input w-full",placeholder:"Entertainment",value:P.category,onChange:$})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Payment Method"}),e.jsx("input",{type:"text",name:"paymentMethod",className:"input w-full",placeholder:"Credit Card, PayPal...",value:P.paymentMethod,onChange:$})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Next Billing"}),e.jsx("input",{type:"date",name:"nextBillingDate",required:!0,className:"input w-full",value:P.nextBillingDate,onChange:$})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full mt-2",children:v?"Update Subscription":"Save Subscription"})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-500 p-6 text-white relative",children:[e.jsx("button",{onClick:()=>k(null),className:"absolute top-4 right-4 text-white/80 hover:text-white",children:e.jsx(m,{size:24})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-white/20 flex items-center justify-center text-white text-3xl font-bold backdrop-blur-sm",children:D.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:D.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-blue-100",children:D.category}),q(D)&&e.jsx("span",{className:"px-2 py-0.5 bg-amber-400/30 text-amber-100 rounded-full text-[10px] font-bold border border-amber-300/30",children:"HIGH COST"})]})]})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[O(D)&&e.jsxs("div",{className:`p-3 rounded-xl border flex items-center gap-2 ${O(D).color}`,children:[e.jsx(r,{size:16}),e.jsxs("span",{className:"text-sm font-semibold",children:["Payment ","Overdue"===O(D).label?"is overdue":`due ${O(D).label.toLowerCase()}`]})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-muted",children:"Cost"}),e.jsxs("p",{className:"text-xl font-bold text-text-main",children:["$",D.price]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-text-muted",children:"Billing Cycle"}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-md text-xs font-semibold",children:D.period||D.billingCycle})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-text-main",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-text-muted",children:e.jsx(x,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Next Billing Date"}),e.jsx("p",{className:"font-medium",children:new Date(D.nextPayment||D.nextBillingDate).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-text-main",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-text-muted",children:e.jsx(i,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Payment Method"}),e.jsx("p",{className:"font-medium",children:D.paymentMethod||"Credit Card"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-text-main",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg text-text-muted",children:e.jsx(x,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-text-muted",children:"Added On"}),e.jsx("p",{className:"font-medium",children:new Date(D.createdAt).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsx("div",{className:"pt-4 mt-2",children:e.jsx("button",{onClick:()=>k(null),className:"btn btn-secondary w-full",children:"Close Preview"})})]})]})})]})};export{b as default};
